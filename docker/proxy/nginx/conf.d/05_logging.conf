# - Structured-ish access log to stdout
# - Drop noisy internal endpoints from access log

log_format devops
  '$remote_addr - $remote_user [$time_local] '
  '"$request" $status $body_bytes_sent '
  '"$http_referer" "$http_user_agent" '
  'host=$host rt=$request_time '
  'uct=$upstream_connect_time urt=$upstream_response_time '
  'uaddr=$upstream_addr ustatus=$upstream_status';

# 0 = don't log
map $request_uri $loggable {
  default 1;
  ~^/_internal/ 0;
  ~^/healthz$ 1; # これは残してもOK、消したければ 0 に
}

access_log /dev/stdout devops if=$loggable;
error_log  /dev/stderr warn;