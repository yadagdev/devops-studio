# Internal-only health port (docker network use)
server {
  listen 18080;
  server_name _;

  # auth off (internal)
  auth_basic off;

  # lightweight
  location = /healthz {
    default_type text/plain;
    return 200 "ok\n";
  }

  # internal healthz (same response as external internal health if you want)
  location = /_internal/healthz {
    default_type text/plain;
    return 200 "ok\n";
  }

  # upstream check for delay-api
  location = /_internal/upstream/delay-api {
    proxy_pass http://delay-api:3101/healthz;
    proxy_connect_timeout 2s;
    proxy_read_timeout 5s;
  }
}
