# Monitoring-only endpoints (no app exposure)
# - /_internal/healthz : proxy liveness
# - /_internal/upstream/<app> : proxy -> upstream connectivity

# NOTE:
# - These locations are expected to be included inside the HTTPS server block.
# - Keep this file "location only" (no server{}).

# ---- proxy liveness (static response) ----
location = /_internal/healthz {
  access_log off;
  auth_basic off;

  include /etc/nginx/snippets/ratelimit_health.conf;

  default_type text/plain;
  return 200 "ok\n";
}

# ---- upstream checks ----
# delay-api
location = /_internal/upstream/delay-api {
  access_log off;
  auth_basic off;

  include /etc/nginx/snippets/ratelimit_health.conf;

  # (Option A) allowlist here (recommended)
  # allow 192.168.1.0/24;   # LAN for local debug
  # allow <UPTIMEROBOT_IP_1>;
  # allow <UPTIMEROBOT_IP_2>;
  # deny all;

  include /etc/nginx/snippets/proxy_headers.conf;
  include /etc/nginx/snippets/proxy_common.conf;

  # Call the upstream health endpoint directly
  proxy_pass http://delay-api:3101/healthz;
}
